docker.enabled = true
// Ensure files created by containerised processes are owned by the invoking user.
// This prevents root-owned files in `work/` which can break `rm -rf work`.
docker.fixOwnership = true

weblog {
    // 1. Enable the weblog feature
    enabled = true

    // 2. Set the URL endpoint to which Nextflow will send HTTP POST requests
    url = 'http://localhost:8088'

    // Optional: Add a basic authentication token if your endpoint requires it
    // basicToken = 'USER:PASSWORD'
}

profiles {
    test{ includeConfig 'conf/test.config'       }
    docker {
        docker.enabled         = true
        docker.fixOwnership    = true
        conda.enabled          = false
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
        apptainer.enabled      = false
    }
    gck { includeConfig 'conf/gck.config'        }
}


// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Set default registry for Docker and Podman independent of -profile
// Will not be used unless Docker / Podman are enabled
// Set to your registry if you have a mirror of containers
docker.registry = 'quay.io'
podman.registry = 'quay.io'

// Default output directory for this example (can be overridden by `--outdir`)
params {
    outdir = 'results'
    // default input samplesheet for the local example
    input_csv = 'data/paired-end.csv'
    // optional alternative, kept for backwards compatibility
    input = null
}

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
// NOTE: Don't reference `params.*` from inside config blocks (eg `timeline {}`), because
// reading missing keys in a ConfigObject can *create* nested config attributes like
// `timeline.params.outdir`, which Nextflow then rejects during config validation.
// Capture the global params value once here and use the local variable instead.
def outdir = params.outdir
timeline {
    enabled = true
    file    = "${outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}